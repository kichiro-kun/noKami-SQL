# -*- coding: utf-8 -*-
# Copyright 2025 kichiro-kun (Kei)
# Apache license, version 2.0 (Apache-2.0 license)

"""
Интерфейс выполнения SQL запросов.

Этот модуль содержит абстрактный базовый класс `QueryInterface`, который
определяет контракт для выполнения SQL запросов с различными сценариями
возврата данных. Интерфейс используется компонентами уровня работы с
базой данных и инкапсулирует логику взаимодействия с курсором и
параметрами запросов.

Интерфейс разделяет операции по типу ожидаемого результата:
    * запросы без возвращаемых строк (например, `INSERT`, `UPDATE`, `DELETE`);
    * запросы, возвращающие одну запись;
    * запросы, возвращающие все записи;
    * запросы, возвращающие ограниченное число записей.


Реализации `QueryInterface` должны обеспечивать:
    * безопасную подстановку параметров запроса;
    * корректное получение результата от курсора;
    * единообразный формат возвращаемых значений для каждого метода.

Пример использования (псевдокод):
    >>> class MyQueryInterface(QueryInterface):
    ...     def execute_query_no_returns(self, *params, query: str) -> None:
    ...         ...
    ...     def execute_query_returns_one(self, *params, query: str) -> Sequence:
    ...         ...
    ...     def execute_query_returns_all(self, *params, query: str) -> Sequence:
    ...         ...
    ...     def execute_query_returns_many(self, *params, query: str, returns_count: int) -> Sequence:
    ...         ...
    ...
    >>> query_interface = MyQueryInterface()
    >>> query = 'INSERT INTO users (name, email) VALUES (?, ?)'
    >>> values = ('Kei', 'kei@example.com')
    >>> query_interface.execute_query_no_returns(query=query, *values)
"""

__author__ = 'kichiro-kun (Kei)'
__version__ = '0.1.3'

# =======================================================================================
from abc import ABC, abstractmethod
from typing import Sequence


# _______________________________________________________________________________________
class QueryInterface(ABC):
    """
    Абстрактный интерфейс для выполнения SQL запросов.

    Этот класс описывает интерфейс слоя запросов к базе данных и определяет методы
    для выполнения SQL инструкций с различными типами возвращаемых результатов.
    Конкретные реализации должны инкапсулировать детали работы с соединением и курсором,
    а также обработку ошибок и управление параметрами запросов.
    """

    # -----------------------------------------------------------------------------------
    @abstractmethod
    def execute_query_no_returns(self, *params, query: str) -> None:
        """
        Выполнение SQL запроса без возвращаемых строк результата.


        Метод предназначен для запросов, результат которых не требуется читать в коде.
        К примеру: `INSERT`, `UPDATE`, `DELETE`, а также `DDL` запросы
        (`CREATE TABLE`, `ALTER TABLE`, `DROP TABLE` и т.д.).


        Args:
            *params: Параметры, подставляемые в плейсхолдеры SQL запроса.
            query (str): Строка SQL запроса с плейсхолдерами для параметров.


        Raises:
            Exception: В случае ошибки выполнения SQL запроса.
        """

    # -----------------------------------------------------------------------------------
    @abstractmethod
    def execute_query_returns_one(self, *params, query: str) -> Sequence:
        """
        Выполнение SQL запроса с возвратом одной записи результата.


        Метод используется для запросов, которые логически должны возвращать не более одной строки
        (по первичному ключу, агрегированные запросы и т.п.).

        Конкретная реализация должна определять поведение в случае, если база данных возвращает
        более одной записи (например, выбрать первую запись или инициировать исключение).


        Args:
            *params: Параметры, подставляемые в плейсхолдеры SQL запроса.
            query (str): Строка SQL запроса с плейсхолдерами для параметров.


        Returns:
            Sequence: Последовательность значений колонок одной записи
            результата или пустая последовательность, если записей нет.


        Raises:
            Exception: В случае ошибки выполнения SQL запроса.
        """

    # -----------------------------------------------------------------------------------
    @abstractmethod
    def execute_query_returns_all(self, *params, query: str) -> Sequence:
        """
        Выполнение SQL запроса с возвратом всех строк результата.


        Метод применяется для получения полного набора строк
        результата по запросу. Использование этого метода на больших
        выборках данных требует осторожности во избежание чрезмерного
        потребления памяти.


        Args:
            *params: Параметры, подставляемые в плейсхолдеры SQL запроса.
            query (str): Строка SQL запроса с плейсхолдерами для параметров.


        Returns:
            Sequence: Последовательность записей результата, где каждая
            запись представлена последовательностью значений колонок.
            Если записей нет, возвращается пустая последовательность.


        Raises:
            Exception: В случае ошибки выполнения SQL запроса.
        """

    # -----------------------------------------------------------------------------------
    @abstractmethod
    def execute_query_returns_many(self, *params, query: str, returns_count: int) -> Sequence:
        """
        Выполнение SQL запроса с возвратом ограниченного числа строк.


        Метод подходит для сценариев постраничного чтения (пагинации)
        или поэтапной обработки результатов, когда необходимо получить
        не более заданного количества строк за один вызов.


        Args:
            *params: Параметры, подставляемые в плейсхолдеры SQL запроса.
            query (str): Строка SQL запроса с плейсхолдерами для параметров.
            returns_count (int): Максимальное количество возвращаемых строк.


        Returns:
            Sequence: Последовательность из 0..`returns_count` записей
            результата, каждая запись представлена последовательностью
            значений колонок.


        Raises:
            Exception: В случае ошибки выполнения SQL запроса.
        """
